<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
        <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
        <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    </head>
    <body>
        <form id="pendataanForm">
        <div class="container py-5 my-2 border" data-role="page" id="page1">
            <div class="row mx-1 gx-5 mb-3 justify-content-center py-1 px-2" style="background-color: #356C7D;">
                <h4 style="color:#FFFFFF;">PILIH PASAR</h4>
            </div>
            <div class="row mx-1 gx-5 mb-3">
                <div class="col">
                    <!--<label for="pilih_psr" class="form-label">Pilih Pasar</label>-->
                    <select class="form-control" id="pilih_psr">
                        <option selected>Daftar Pasar</option>
                        <option >Pasar Nusukan</option>
                        <option >Pasar Legi</option>
                        <option >Pasar Gede Hardjonagoro</option>
                        <option >Pasar Harjodaksino</option>
                      </select>                   
                </div>
            </div>
            <div class="row mx-1">
                <div class="col text-center">
                    <button type="button" class="btn btn-danger pilihPsr" data-role="none">SUBMIT</button>
                </div>
            </div>
            <script language="javascript">
                $(function() {
                    var Psr = '';
                    var Koordinat = {};
                    $(".pilihPsr").on('click', function() {
                        Psr = $("#pilih_psr").children("option:selected").text();
                        if (Psr == "Daftar Pasar") {
                            $.mobile.changePage("#page4", {role : "dialog"});
                            $(".msg_container").html(`Anda belum memilih pasar, Silahkan pilih dahulu ...<br><br><a href="#page1"><< Kembali</a>`);
                            return false;
                        }
                        $.mobile.changePage("#page2", {role : "dialog"});
                        $(".jumbo_page2").html(`
                            <h1 class="display-5">Halo, Apa Kabar!</h1>
                            <p>Anda sedang berada di <b>`+Psr+`</b>.<p id="posisi"></p>  
                            <hr class="my-4">
                            <p>Silahkan mengisi data pedagang pasar lalu tekan tombol 'Selanjutnya ...' untuk mengisi UTTP-nya</p>
                            <p align="right"><a href="#page1" id="gantiPsr">ganti pasar</a></p>
                        `);
                        /*    
                        const geoPosisi = new Promise((resolve, reject) => {
                            if (navigator.geolocation) {
                                navigator.geolocation.getCurrentPosition(function(pos) {
                                    let lat = pos.coords.latitude;
                                    let long = pos.coords.longitude;
                                    resolve({latitude : lat, longitude : long});
                                });                         
                            } else {
                                reject("Browser Anda tidak mendukung fitur Geolocation atau GPS Anda belum diaktifkan");
                            } 
                        });
                        
                        const geoPosisi = new Promise((resolve, reject) => {
                            if (navigator.geolocation) {
                                navigator.geolocation.watchPosition(function(pos) {
                                    let lat = pos.coords.latitude;
                                    let long = pos.coords.longitude;
                                    resolve({latitude : lat, longitude : long});
                                });                         
                            } else {
                                reject("Browser Anda tidak mendukung fitur Geolocation atau GPS Anda belum diaktifkan");
                            } 
                        });

                        geoPosisi.then((location) => {
                            $("#posisi").html('Lat : <b>'+location.latitude+'</b><br>Long : <b>'+location.longitude)+'</b>';
                            Koordinat = location;
                        });
                        */
                        const watcId = navigator.geolocation.watchPosition(position => {
                            $("#posisi").html('Koordinat : <b>'+position.coords.latitude+','+position.coords.longitude+'</b>');
                            Koordinat = {latitude : position.coords.latitude, longitude : position.coords.longitude};
                        });

                        //Cek apakah inputan nomor HP adalah number
                        $("#hp").on('keyup', function() {
                            //console.log($(this).val().charAt($(this).val().length-1))
                            pola = /[0-9]|-|\s/g;
                            karakter = $(this).val().charAt($(this).val().length-1);
                            if (pola.test(karakter)) {
                                return;
                            } else {
                                alert("Maaf, hanya bisa memasukkan angka dan tanda '-'");
                                $(this).val($(this).val().slice(0,$(this).val().length-1));
                            }
                        });
                    });

                    $(".next_uttp").on("click", function() {
                        if ($("#Nama").val() == '' || $("#los").val() == '' || $("#hp").val() == '') {
                            $.mobile.changePage('#page4', {role : "dialog"});
                            $(".msg_container").html(`<p><h4>Maaf, belum bisa ke halaman selanjutnya....</h4><br>Nama pedagang/wtu, los pasar, atau No. telepon masih ada yg kosong, silahkan diisi dahulu, atau isi dengan tanda '-' jika memang kosong.<br></p><p><a href="#page2"><< Kembali</a></p>`);
                            return;
                        }
                        $.mobile.changePage("#page3", {role : "dialog"});
                        $(".jumbo_page3").html(`
                            <p>Lokasi : <b>`+Psr+`</b>.<br>Pedagang / WTU : <b>Bp/Ibu `+$("#Nama").val()+`</b><br>No Los : <b>`+$("#los").val()+`</b><br>Telepon/WA : <b>`+$("#hp").val()+`</b><br>Lat : <b>`+Koordinat.latitude+`</b><br>Long : <b>`+Koordinat.longitude+`</b>  
                            <hr class="my-4">
                            <p>Silahkan mengisi data UTTP nya pada form dibawah ini, setelah itu tekan tombol 'Submit'.</p>
                        `);
                    });

                    $(".jumbo_page2").on("click","#gantiPsr", function() {
                        $("#pendataanForm").trigger('reset');
                    });
                });
            </script>

        </div>
        <div class="container py-5 my-2 border" data-role="page" id="page2">
            <div class="jumbotron jumbo_page2">
            </div>
            <div class="row my-4 mx-4 gx-5 mb-3 py-2 px-2" style="background-color: #4682BF;">
                <h4 style="color:#FFFFFF;">DATA PEDAGANG/WTU</h4>
            </div>
            <div class="row mx-1 gx-5 mb-3">
                <div class="col">
                    <label for="Nama" class="form-label">Nama Pedagang / WTU</label>
                    <input type="text" class="form-control" id="Nama" placeholder="">            
                </div>
            </div>
            <div class="row mx-1 gx-5 mb-3">
                <div class="col">
                    <label for="los" class="form-label">Nomer Los Pasar</label>
                    <input type="text" class="form-control" id="los" placeholder="">            
                </div>
            </div>
            <div class="row mx-1 gx-5 mb-3">
                <div class="col">
                    <label for="hp" class="form-label">Nomor Handphone Pedagang</label>
                    <input type="text" class="form-control" id="hp" placeholder="">            
                </div>
            </div>
            <div class="row mx-1 gx-5 mb-3">
                <div class="col text-center pb-2">
                    <button type="button" class="btn btn-info next_uttp" data-role="none">Selanjutnya ...</button>
                </div>
            </div>
        </div>        
        <div class="container py-5 my-2 border" data-role="page" id="page3">
            <div class="jumbotron jumbo_page3">
            </div>
            <div class="row mx-1 gx-5 mb-3">
                <div class="col-md-6 py-2">
                    <div class="mr-1 px-2 py-2 border">
                        <div class="mb-3 px-2 py-2 bg-primary">
                            <h4 style="color : #FFFFFF;">UTTP 1</h4>
                        </div>
        
                        <div class="mb-3">
                            <label for="uttp1" class="form-label">Jenis UTTP</label>
                            <select class="form-control pilih_uttp" id="uttp1">
                                <option value="" selected>Pilih jenis UTTP</option>
                                <option value="TM - 25 kg - 20 g">TM - 25 kg</option>
                                <option value="TM - 10 kg - 10 g">TM - 10 kg</option>
                                <option value="TM - 5 kg - 5 g">TM - 5 kg</option>
                                <option value="TM - 3 kg - 3 g">TM - 3 kg</option>
                                <option value="TS - 500 kg - 100 g">TS - 500 kg</option>
                                <option value="TS - 300 kg - 100 g">TS - 300 kg</option>
                                <option value="TS - 150 kg - 100 g">TS - 150 kg</option>
                                <option value="DL - 110 kg - 100 g">DL - 110 kg</option>
                                <option value="DL - 50 kg - 100 g">DL - 50 kg</option>
                                <option value="DL - 25 kg - 100 g">DL - 25 kg</option>
                                <option value="N - 1000 g - 500 mg">N - 1000 g</option>
                                <option value="N - 500 g - 250 mg">N - 500 g</option>
                                <option value="N - 250 g - 125 mg">N - 250 g</option>
                                <option value="N - 100 g - 50 mg">N - 100 g</option>
                                <option value="N - 50 g - 25 mg">N - 50 g</option>
                                <option value="TE - - ">TE</option>
                                <option value="TP - - ">TP</option>
                              </select>                        
                        </div>
                        <div class="mb-3"><label for="kap1" class="form-label">Kapasitas</label>
                            <input type="text" class="form-control" id="kap1" placeholder="">     
                        </div>        
                        <div class="mb-3">
                            <label for="d1" class="form-label">Dayabaca</label>
                            <input type="text" class="form-control" id="d1" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="merk1" class="form-label">Merek (Khusus TE dan TP)</label>
                            <input type="text" class="form-control" id="merk1" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="model1" class="form-label">Model (Khusus TE dan TP)</label>
                            <input type="text" class="form-control" id="model1" placeholder=""> 
                        </div>
                        <div class="mb-3">
                            <label for="tahunTera1" class="form-label">Tahun Tera</label>
                            <input type="text" class="form-control" id="tahunTera1" placeholder=""> 
                        </div>
                    </div>      
                </div>
                <div class="col-md-6 py-2" hidden>
                    <div class="mr-1 px-2 py-2 border">
                        <div class="mb-3 px-2 py-2 bg-primary">
                            <h4 style="color : #FFFFFF;">UTTP 2</h4>
                        </div>
                        <div class="mb-3">
                            <label for="uttp2" class="form-label">Jenis UTTP</label>
                            <select class="form-control pilih_uttp" id="uttp2">
                                <option value="" selected>Pilih jenis UTTP</option>
                                <option value="TM - 25 kg - 20 g">TM - 25 kg</option>
                                <option value="TM - 10 kg - 10 g">TM - 10 kg</option>
                                <option value="TM - 5 kg - 5 g">TM - 5 kg</option>
                                <option value="TM - 3 kg - 3 g">TM - 3 kg</option>
                                <option value="TS - 500 kg - 100 g">TS - 500 kg</option>
                                <option value="TS - 300 kg - 100 g">TS - 300 kg</option>
                                <option value="TS - 150 kg - 100 g">TS - 150 kg</option>
                                <option value="DL - 110 kg - 100 g">DL - 110 kg</option>
                                <option value="DL - 50 kg - 100 g">DL - 50 kg</option>
                                <option value="DL - 25 kg - 100 g">DL - 25 kg</option>
                                <option value="N - 1000 g - 500 mg">N - 1000 g</option>
                                <option value="N - 500 g - 250 mg">N - 500 g</option>
                                <option value="N - 250 g - 125 mg">N - 250 g</option>
                                <option value="N - 100 g - 50 mg">N - 100 g</option>
                                <option value="N - 50 g - 25 mg">N - 50 g</option>
                                <option value="TE - - ">TE</option>
                                <option value="TP - - ">TP</option>
                              </select>                        
                        </div>
                        <div class="mb-3"><label for="kap2" class="form-label">Kapasitas</label>
                            <input type="text" class="form-control" id="kap2" placeholder="">     
                        </div>        
                        <div class="mb-3">
                            <label for="d2" class="form-label">Dayabaca</label>
                            <input type="text" class="form-control" id="d2" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="merk2" class="form-label">Merek (Khusus TE dan TP)</label>
                            <input type="text" class="form-control" id="merk2" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="model2" class="form-label">Model (Khusus TE dan TP)</label>
                            <input type="text" class="form-control" id="model2" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="tahunTera2" class="form-label">Tahun Tera</label>
                            <input type="text" class="form-control" id="tahunTera2" placeholder=""> 
                        </div>
    
                    </div>
                </div>
            </div>
            <div class="row mx-1 gx-5 mb-3" hidden>
                <div class="col-md-6 py-2">
                    <div class="mr-1 px-2 py-2 border">
                        <div class="mb-3 px-2 py-2 bg-success">
                            <h4 style="color : #FFFFFF;">UTTP 3</h4>
                        </div>
        
                        <div class="mb-3">
                            <label for="uttp1" class="form-label">Jenis UTTP</label>
                            <select class="form-control pilih_uttp" id="uttp3">
                                <option value="" selected>Pilih jenis UTTP</option>
                                <option value="TM - 25 kg - 20 g">TM - 25 kg</option>
                                <option value="TM - 10 kg - 10 g">TM - 10 kg</option>
                                <option value="TM - 5 kg - 5 g">TM - 5 kg</option>
                                <option value="TM - 3 kg - 3 g">TM - 3 kg</option>
                                <option value="TS - 500 kg - 100 g">TS - 500 kg</option>
                                <option value="TS - 300 kg - 100 g">TS - 300 kg</option>
                                <option value="TS - 150 kg - 100 g">TS - 150 kg</option>
                                <option value="DL - 110 kg - 100 g">DL - 110 kg</option>
                                <option value="DL - 50 kg - 100 g">DL - 50 kg</option>
                                <option value="DL - 25 kg - 100 g">DL - 25 kg</option>
                                <option value="N - 1000 g - 500 mg">N - 1000 g</option>
                                <option value="N - 500 g - 250 mg">N - 500 g</option>
                                <option value="N - 250 g - 125 mg">N - 250 g</option>
                                <option value="N - 100 g - 50 mg">N - 100 g</option>
                                <option value="N - 50 g - 25 mg">N - 50 g</option>
                                <option value="TE - - ">TE</option>
                                <option value="TP - - ">TP</option>
                              </select>                        
                        </div>
                        <div class="mb-3"><label for="kap3" class="form-label">Kapasitas</label>
                            <input type="text" class="form-control" id="kap3" placeholder="">     
                        </div>        
                        <div class="mb-3">
                            <label for="d3" class="form-label">Dayabaca</label>
                            <input type="text" class="form-control" id="d3" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="merk3" class="form-label">Merek (Khusus TE dan TP)</label>
                            <input type="text" class="form-control" id="merk3" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="model3" class="form-label">Model (Khusus TE dan TP)</label>
                            <input type="text" class="form-control" id="model3" placeholder=""> 
                        </div>
                        <div class="mb-3">
                            <label for="tahunTera3" class="form-label">Tahun Tera</label>
                            <input type="text" class="form-control" id="tahunTera3" placeholder=""> 
                        </div>
                    </div>      
                </div>
                <div class="col-md-6 py-2" hidden>
                    <div class="mr-1 px-2 py-2 border">
                        <div class="mb-3 px-2 py-2 bg-success">
                            <h4 style="color : #FFFFFF;">UTTP 4</h4>
                        </div>
                        <div class="mb-3">
                            <label for="uttp4" class="form-label">Jenis UTTP</label>
                            <select class="form-control pilih_uttp" id="uttp4">
                                <option value="" selected>Pilih jenis UTTP</option>
                                <option value="TM - 25 kg - 20 g">TM - 25 kg</option>
                                <option value="TM - 10 kg - 10 g">TM - 10 kg</option>
                                <option value="TM - 5 kg - 5 g">TM - 5 kg</option>
                                <option value="TM - 3 kg - 3 g">TM - 3 kg</option>
                                <option value="TS - 500 kg - 100 g">TS - 500 kg</option>
                                <option value="TS - 300 kg - 100 g">TS - 300 kg</option>
                                <option value="TS - 150 kg - 100 g">TS - 150 kg</option>
                                <option value="DL - 110 kg - 100 g">DL - 110 kg</option>
                                <option value="DL - 50 kg - 100 g">DL - 50 kg</option>
                                <option value="DL - 25 kg - 100 g">DL - 25 kg</option>
                                <option value="N - 1000 g - 500 mg">N - 1000 g</option>
                                <option value="N - 500 g - 250 mg">N - 500 g</option>
                                <option value="N - 250 g - 125 mg">N - 250 g</option>
                                <option value="N - 100 g - 50 mg">N - 100 g</option>
                                <option value="N - 50 g - 25 mg">N - 50 g</option>
                                <option value="TE - - ">TE</option>
                                <option value="TP - - ">TP</option>
                              </select>                        
                        </div>
                        <div class="mb-3"><label for="kap4" class="form-label">Kapasitas</label>
                            <input type="text" class="form-control" id="kap4" placeholder="">     
                        </div>        
                        <div class="mb-3">
                            <label for="d4" class="form-label">Dayabaca</label>
                            <input type="text" class="form-control" id="d4" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="merk4" class="form-label">Merek (Khusus TE dan TP)</label>
                            <input type="text" class="form-control" id="merk4" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="model4" class="form-label">Model (Khusus TE dan TP)</label>
                            <input type="text" class="form-control" id="model4" placeholder=""> 
                        </div>      
                        <div class="mb-3">
                            <label for="tahunTera4" class="form-label">Tahun Tera</label>
                            <input type="text" class="form-control" id="tahunTera4" placeholder=""> 
                        </div>
    
                    </div>
                </div>
            </div>
            <div>
                <div class="col text-center pb-2">
                    <button type="button" class="btn btn-info submit" data-role="none">Submit</button>
                </div>
            </div>                
        </div>        
        <script language="javascript">
            var setInputForm = function(Index, kap, d, state) {
                $("#kap"+Index).val(kap).attr('readonly', state);   
                $("#d"+Index).val(d).attr('readonly', state);   
                $("#merk"+Index).attr('readonly', state);
                $("#model"+Index).attr('readonly', state);
                if (state == true) {
                    $("#tahunTera"+Index).focus();
                } else {
                    $("#kap"+Index).focus();
                }
            } 
            var resetFormUTTP = function(id) {
                let arr = ["kap","d","merk","model","tahunTera"]
                for (i=0;i<arr.length;i++) {
                    $("#"+arr[i]+id).val("");
                }
            }

            $(function() {
                $(".pilih_uttp").on('change', function() {
                    let this_Index = $(this)[0].id.charAt($(this)[0].id.length-1);
                    setInputForm(this_Index,'','',false);
                    resetFormUTTP(this_Index);
                    let theString = $(this).children("option:selected").val().split("-");
                    if (theString[0].trim() != 'TE' && theString[0].trim() != 'TP') {
                        let kap = theString[1].trim();
                        let d = theString[2].trim();
                        setInputForm(this_Index,kap,d,true);
                    }
                });
            });
        </script>
        <div class="container py-5 my-2 border" data-role="page" id="page4">
            <div class="alert alert-danger msg_container" role="alert">
            </div>
        </div>
        </form>
    </body>
</html>
