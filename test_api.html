<!DOCTYPE html>
<html lang="en">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>TEST WEBAPP</title>
    </head>
	
    <body>
		<!--
		<input type="text" name="jeneng" id="jeneng">
		<input type="text" name="alat" id="alat">
		<button id="sendBtn">Send Data</button>
		<button id="getBtn">Get Data</button>
		<div id="app"></div>

		-->
		<script language="javascript">
			/*
			function getData() {
				const webAppUrl = "https://script.google.com/macros/s/AKfycbz2Bz051C2QYjMBBW2Nrynu4m2RQwnv41fGT9CweW0aYClzGfcGLLJ2Qy2lFeyesNHEtQ/exec";
				
				fetch(webAppUrl).then(d => d.json()).then(d => {
						console.log(d[0].tahun);
				});	
			}
			*/
			/*
			function sendData() {
				const webAppUrl = "https://script.google.com/macros/s/AKfycbwiJLg0tV08M2U2xymkL9aIYwj7G8VigJzsYlJfe0CSEa3eDKF0/exec";
				fetch(webAppUrl,{
					method : 'POST',
					mode : 'no-cors',
					cache : 'no-cache',
					credentials : 'omit',
					headers : {
						'Content-type' : 'application/json'
					},
					redirect : 'follow',
					body : JSON.stringify({nama : document.getElementById('jeneng').value, uttp : document.getElementById('alat').value})
				})
			}
			*/
			/*
			function sendData() {
				//const webAppUrl = "https://script.google.com/macros/s/AKfycbznTP423iwL-5eRomjbuvspjfMzSkH_sb4np3sTx_scyukLxy0H6h2TyqY9qpP7XymN/exec";
				//const webAppUrl = "https://script.google.com/macros/s/AKfycbxyTVAzHq-FEwvLqphq5pB6Q1o6fSfpfIxghlU9oJMjZ7bx8ykwxV5-FZOJtLKNQHHV/exec";
				const webAppUrl = "https://script.google.com/macros/s/AKfycbyWftlQ23gagoHG6Rvn8F64xtynf8HnshkhR-GE39XI07sy8yrnt0bWO7b1xfwzS0NG/exec";
				//fetch(webAppUrl).then(respon => respon.json()).then(respon => console.log(respon)).catch(err => console.log(err));
				
				fetch(webAppUrl,{
						method : 'POST',
						body : JSON.stringify({'kodeQrLama' : 'trsari002', 'kodeQrBaru' : 'trsari002'})
					})
					.then(respon => respon.json()).then(respon => {
						//console.log('berhasil');
						console.log(respon);
					})
					.catch(err => {
						console.log('error');
					});
				
			}
			document.getElementById("sendBtn").addEventListener("click",sendData);		
			//document.getElementById("getBtn").addEventListener("click",getData);
			*/

			function sendNewQRCode(nomorBaris, newQRCode) {
                const webAppUrl3 = "https://script.google.com/macros/s/AKfycby_uNKxXq0DS5wqa8KoUWPnrF6jTgHEXFG5F58t3qvKasfd_ot5epBNX3l4b5xV2C0v/exec";

                return fetch(webAppUrl3, {
                    method : 'POST',
                    body : JSON.stringify({'nomorBaris' : nomorBaris, 'newQRCode' : newQRCode})
                })
                .then(resp => resp.json())
                .then(resp => {
                    if (resp.result === "error") {
                        throw "error";
                    }
                    return resp;
                })
                .catch(e => 'Error on server or client : gagal mengganti dgn QRCode baru..');

                /*
                return new Promise((resolve, reject) => {
                    fetch(webAppUrl3, {
                        method : 'POST',
                        body : JSON.stringify({'nomorBaris' : nomorBaris, 'newQRCode' : newQRCode})
                    })
                    .then(resp => resp.json())
                    .then(resp => resolve({'result' : true, 'data' : resp}))
                    .catch(e => reject({'result' : false}));
                });
                */
			   
            }
		
			async function utama() {
				//console.log('Mulai');
				const c = await sendNewQRCode(122,'PRLEGI2000');
				console.log(c);
				//console.log('Selesai');
				if (c.result === "success") {
		
					let resultStr = `Old Code : ${c.dataBefore[122][1]}<br>New Code : ${c.dataAfter[122][1]}<br>Status : ${c.result}`;
					console.log(resultStr);
					
				} else {
					let resultStr = ubahQRCode;
					console.log('error');
				}

			}

			utama();
        </script>
    </body>
</html>